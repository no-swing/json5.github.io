(()=>{"use strict";function t(t,e,o,n){return new(o||(o=Promise))((function(r,s){function i(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(i,l)}c((n=n.apply(t,e||[])).next())}))}function e(t,e){var o,n,r,s,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function l(s){return function(l){return function(s){if(o)throw new TypeError("Generator is already executing.");for(;i;)try{if(o=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],n=0}finally{o=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}var o=!1,n="@inventorjs/stats-web",r=function(){function r(t){var e=void 0===t?{}:t,n=e.lowThreshold,r=void 0===n?0:n,s=e.lowThresholdPercent,i=void 0===s?.5:s,l=e.lowSamplePercent,c=void 0===l?.5:l,a=e.collectDuration,h=void 0===a?1e4:a,u=e.collectInterval,d=void 0===u?1e3:u,f=e.collectMaxCount,p=void 0===f?0:f,w=e.monitorEvents,m=void 0===w?["DOMContentLoaded","scroll","click","focus"]:w,v=e.report;this.collectPromise=null,this.stopCollect=function(){},this.lowThreshold=0,this.lowThresholdPercent=0,this.lowSamplePercent=0,this.collectInterval=0,this.collectDuration=0,this.collectMaxCount=0,this.collectCount=0,this.monitorEvents=[],this.lowRefreshNum=0,this.normalRefreshNum=0,this.highRefreshNum=0,this.exHighRefreshNum=0,this.ratedFpsCache=0,this.monitorHandlers={};var b="FpsStats";o?console.warn("".concat(b,": 实例初始化失败, 当前统计对象仅支持单个实例")):"undefined"!=typeof Promise?!Number(d)||!Number(h)||d<0||h<0?console.warn("".concat(b,": collectInterval 和 collectDuration 必须是一个正整数")):d>h?console.warn("".concat(b,": collectInterval 必须小于 collectDuration 以采集正确的样本数")):isNaN(r)||r&&(r<0||r>=60)?console.warn("".concat(b,": lowThreshold 必须是小于浏览器额定帧率的整数")):!Number(i)||i<0||i>1?console.warn("".concat(b,": lowThresholdPercent 必须是[0, 1]之间的小数")):!Number(c)||c<0||c>1?console.warn("".concat(b,": lowSamplePercent 必须是[0, 1]之间的小数")):(o=!0,this.lowThresholdPercent=i,this.lowSamplePercent=c,this.collectDuration=h,this.collectInterval=d,this.collectMaxCount=p,this.monitorEvents=m,this.lowThreshold=r,this.report=v,this.monitorHandlers={}):console.warn("".concat(b,": 实例初始化失败, 当前环境未支持 Promise"))}return Object.defineProperty(r.prototype,"ratedFps",{get:function(){return this.ratedFpsCache||(this.exHighRefreshNum>3?this.ratedFpsCache=144:this.highRefreshNum>3?this.ratedFpsCache=120:this.normalRefreshNum>3?this.ratedFpsCache=60:this.lowRefreshNum>3?this.ratedFpsCache=30:(this.ratedFpsCache=0,this.exHighRefreshNum=0,this.highRefreshNum=0,this.normalRefreshNum=0,this.lowRefreshNum=0)),this.ratedFpsCache},enumerable:!1,configurable:!0}),r.prototype.calculateRatedFps=function(t){this.ratedFpsCache||(t<8?this.exHighRefreshNum+=1:t<16?this.highRefreshNum+=1:t<33?this.normalRefreshNum+=1:this.lowRefreshNum+=1)},r.prototype.collect=function(){var t=this;return this.collectPromise||(this.collectPromise=new Promise((function(e,o){var n,r=0,s=0,i=0,l=0,c=[],a=t;n=window.requestAnimationFrame(function t(e){if(l+=1,r){i+=1;var o=e-r,h=e-s;if(this.calculateRatedFps(h),o>=this.collectInterval){var u=Math.round(i/o*1e3);c.push(u),r=e,i=0}}else r=e;s=e,n=window.requestAnimationFrame(t.bind(a))}.bind(a));var h=setTimeout((function(){return t.stopCollect({resolve:{samples:c,rafCount:l}})}),t.collectDuration);t.stopCollect=function(r){var s=void 0===r?{}:r,i=s.resolve,l=s.reject;t.collectPromise=null,cancelAnimationFrame(n),clearTimeout(h),i?e(i):o(l)}}))),this.collectPromise},r.prototype.getStats=function(){return t(this,void 0,void 0,(function(){var t,o,n,r,s,i,l;return e(this,(function(e){switch(e.label){case 0:return[4,this.collect()];case 1:return t=e.sent(),o=t.samples,n=t.rafCount,r=this.lowThreshold||this.ratedFps*this.lowThresholdPercent,s=o.filter((function(t){return t<=r})),i=!1,l=o.length>0?s.length/o.length:0,(!o.length||l>=this.lowSamplePercent)&&(i=!0),[2,{isLow:i,samples:o,lowSamples:s,lowPercent:Math.round(10*l)/10,ratedFps:this.ratedFps,rafCount:n}]}}))}))},r.prototype.startMonitor=function(){var o=this,r=!1;if(this.monitorEvents.forEach((function(n){if(!o.monitorHandlers[n]){var s=function(n){return t(o,void 0,void 0,(function(){var t,o,s,i,l,c,a,h,u;return e(this,(function(e){switch(e.label){case 0:if(this.collectMaxCount>0&&this.collectCount>this.collectMaxCount)return[2,this.stopMonitor()];if(r||document.hidden)return[3,5];this.collectCount+=1,r=!0,e.label=1;case 1:return e.trys.push([1,3,,4]),t=Math.round(null!==(a=null!==(c=window.scrollY)&&void 0!==c?c:window.scrollY)&&void 0!==a?a:0),[4,this.getStats()];case 2:return o=e.sent(),"function"==typeof this.report&&(s=Math.round(null!==(u=null!==(h=window.scrollY)&&void 0!==h?h:window.scrollY)&&void 0!==u?u:0),i={scrollY:[t,s]},this.report({stats:o,event:n,extra:i})),[3,4];case 3:return l=e.sent(),console.warn(l),[3,4];case 4:r=!1,e.label=5;case 5:return[2]}}))}))};window.addEventListener(n,s,{passive:"scroll"===n||void 0}),o.monitorHandlers[n]=s}})),!this.monitorHandlers.blur){var s=function(){o.stopCollect({reject:"".concat(n,": window lose focus, fps collect stopped.")})};window.addEventListener("blur",s),this.monitorHandlers.blur=s}},r.prototype.stopMonitor=function(t){var e=this;void 0===t&&(t=[]),this.stopCollect({reject:"".concat(n,": fps monitor stopped, fps collect stopped.")});var o=t;t.length||(o=this.monitorEvents),o.forEach((function(t){var o=e.monitorHandlers[t];o&&(window.removeEventListener(t,o),delete e.monitorHandlers[t])}))},r}();if(window.QC_AEGIS)try{new r({lowThreshold:24,lowSamplePercent:.5,report:function(t){var e=t.stats,o=t.event,n=t.extra;e.isLow&&window.QC_AEGIS.reportEvent({name:"fps-low",ext2:o.type,ext3:JSON.stringify({stats:e,extra:n})})}}).startMonitor()}catch(t){console.warn(t)}})();